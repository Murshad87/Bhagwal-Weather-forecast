<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bhagwal Weather Dashboard</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
header { background:#1e3a8a; color:white; text-align:center; padding:20px; }
#map { height:400px; border-radius:12px; margin:20px auto; max-width:1000px; }
.weather-section { margin:20px auto; max-width:1000px; }
.weather-section h2 { text-align:center; color:#1e3a8a; margin-bottom:10px; }
.forecast { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
.card { background:white; padding:15px; border-radius:10px; width:120px; text-align:center; box-shadow:0 3px 6px rgba(0,0,0,0.15); color:white; }
.card img { width:50px; height:50px; }
.card p { margin:5px 0; font-size:0.9em; }
.temp-hot { background:#e53e3e; }      
.temp-warm { background:#ed8936; }     
.temp-cool { background:#4299e1; }     
.temp-cold { background:#3182ce; }     
</style>
</head>
<body>

<header>
<h1>Bhagwal Weather Dashboard</h1>
<p>Kharian Tehsil, Gujrat District, Punjab, Pakistan</p>
</header>

<div id="map"></div>
<div id="weather-container"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const apiKey = "2be72ffaa3b107ec1563e3f0061d687e"; // Your OpenWeatherMap key

// Pinned locations
const PIN_LOCATIONS = [
  { name: "Bhagwal", lat: 32.82139585833284, lon: 73.9552418499999 },
  { name: "Kharian", lat: 32.8140, lon: 73.8650 },
  { name: "Gujrat", lat: 32.5739, lon: 74.0789 }
];

// Nearby villages (no pins)
const NEARBY_LOCATIONS = [
  { name:"Guliana", lat:32.9425, lon:73.8540 },
  { name:"Malka", lat:32.8380, lon:73.9500 },
  { name:"Chak Bakhtawar", lat:32.8790, lon:73.9120 },
  { name:"Dham", lat:32.8570, lon:73.9230 },
  { name:"Dhall Gujjar", lat:32.8490, lon:73.9700 },
  { name:"Lammay", lat:32.8100, lon:73.9300 },
  { name:"Shorian", lat:32.7950, lon:73.9450 },
  { name:"Golra Hashim", lat:32.8700, lon:73.8900 },
  { name:"Kotla Haji Shah", lat:32.9000, lon:73.8800 },
  { name:"Jhantla", lat:32.7800, lon:73.9700 },
  { name:"Jand Sharif", lat:32.7600, lon:73.9400 }
];

const map = L.map('map').setView([32.82139585833284, 73.9552418499999], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19, attribution:"© OpenStreetMap contributors" }).addTo(map);

const container = document.getElementById("weather-container");

// Temperature color
function getTempClass(temp){
  if(temp>=35) return 'temp-hot';
  if(temp>=25) return 'temp-warm';
  if(temp>=15) return 'temp-cool';
  return 'temp-cold';
}

// Create forecast card
function createForecastCard(day){
  const date = new Date(day.dt*1000);
  const tempClass = getTempClass(day.temp.day);
  const card = document.createElement("div");
  card.className = "card "+tempClass;
  card.innerHTML = `
    <p>${date.toLocaleDateString('en-US', { weekday: 'short' })}</p>
    <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" alt="${day.weather[0].description}" />
    <p>${Math.round(day.temp.day)}°C</p>
    <p>${day.weather[0].main}</p>
  `;
  return card;
}

// Add map pins first
PIN_LOCATIONS.forEach(loc => {
  const marker = L.marker([loc.lat, loc.lon]).addTo(map).bindPopup(`<b>${loc.name}</b>`);
  marker.on('click', () => {
    const section = document.getElementById(loc.name.replace(/\s/g,''));
    if(section) section.scrollIntoView({ behavior:'smooth' });
  });
});

// Fetch weather data
function fetchWeather(loc){
  fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${loc.lat}&lon=${loc.lon}&exclude=minutely,hourly,alerts&units=metric&appid=${apiKey}`)
  .then(res => res.json())
  .then(data => {
    const section = document.createElement("div");
    section.className = "weather-section";
    section.id = loc.name.replace(/\s/g,'');
    section.innerHTML = `<h2>${loc.name} - 7-Day Forecast</h2>`;
    const forecastDiv = document.createElement("div");
    forecastDiv.className = "forecast";
    data.daily.forEach(day => forecastDiv.appendChild(createForecastCard(day)));
    section.appendChild(forecastDiv);
    container.appendChild(section);
  })
  .catch(err => {
    console.error(`Error fetching weather for ${loc.name}:`, err);
    const section = document.createElement("div");
    section.className = "weather-section";
    section.innerHTML = `<h2>${loc.name} - Forecast Unavailable</h2><p>Check API key or internet connection.</p>`;
    container.appendChild(section);
  });
}

// Fetch weather for all locations
[...PIN_LOCATIONS, ...NEARBY_LOCATIONS].forEach(loc => fetchWeather(loc));

</script>
</body>
</html>
